homeassistant:
  # Name of the location where Home Assistant is running
  name: Home
  # Location required to calculate the time the sun rises and sets
  latitude: !secret home_lat
  longitude: !secret home_lon
  # Impacts weather/sunrise data (meters above sealevel)
  elevation: !secret home_elev
  # 'metric' for the metric system, 'imperial' for the imperial system
  unit_system: imperial
  # Pick yours from here: http://en.wikipedia.org/wiki/List_of_tz_database_time_zones
  time_zone: !secret time_zone
    
    
###################################################
#                 Customization                   #
###################################################

  customize: !include customize.yaml


###################################################
#                      Misc                       #
###################################################

# Configuration for the website
http:
#    api_password: !secret api_pass_code
    base_url: !secret base_url
    
#System health component
system_health:

# Track the sun
sun:

# Discover some devices automatically
discovery:

# View all events in a logbook
logbook:
    include:
        entities:
          - climate.living_room
          - device_tracker.michael_pixel3
        domains:
          - automation
          
# View History of specific items
history:
    include:
        entities:
          - sensor.dark_sky_pressure

# Configuring recorder to keep size down
recorder:
    purge_keep_days: 7
    purge_interval: 1

# Enable config screen
config:

# Enables the frontend
frontend:

# Enable map screen
map:

###################################################
#                     Zones                       #
###################################################
zone:
  name: Work
  latitude: !secret work_lat
  longitude: !secret work_lon
  radius: 300
  icon: mdi:domain

zone 2:
  name: Honda R&D
  latitude: !secret guest_lat
  longitude: !secret guest_lon
  radius: 500
  icon: mdi:factory 

###################################################
#                      Hubs                       #
###################################################

zwave:
    usb_path: /dev/cuaU0
    polling_interval: 10000 # Polling speed in miliseconds
    # High polling number was needed to keep z-wave network stable and working

###################################################
#                    Devices                      #
###################################################




###################################################
#                      nest                       #
###################################################

nest: 
    client_id: !secret nest_client_id
    client_secret: !secret nest_client_secret

###################################################
#                    Weather                      #
###################################################

# Weather Prediction
sensor:
    platform: darksky
    api_key: !secret darksky_key
    scan_interval:
      minutes: 5
    monitored_conditions:
#      - summary
#      - temperature
      - precip_type
      - precip_intensity
      - precip_probability
#      - wind_speed
#      - wind_bearing
#      - cloud_cover
#      - humidity
      - dew_point
      - pressure
      - visibility
#      - ozone
#      - minutely_summary
#      - hourly_summary
#      - daily_summary
      - uv_index

weather:
  - platform: darksky
    api_key: !secret darksky_key
    mode: daily

iqvia:
    zip_code: !secret zipCode
    monitored_conditions:
      - allergy_average_forecasted
#      - allergy_average_historical
      - allergy_index_today
#      - allergy_index_yesterday
      - allergy_index_tomorrow
      - disease_average_forecasted

camera:
    platform: generic
    still_image_url: !secret radar_url
    name: HomeWeatherRadar

###################################################
#                  System info                    #
###################################################

# System resources
sensor 2: 
    - platform: systemmonitor
      resources: 
        - type: 'disk_use_percent'
          arg: '/'
        - type: 'disk_free'
          arg: '/'
        - type: 'memory_use_percent'
        - type: 'memory_use'
        - type: 'memory_free'
#        - type: 'swap_free'
        - type: 'swap_use_percent'
        - type: 'processor_use'
        - type: 'last_boot'
    
    - platform: command_line
      name: cpu_0_temperature
      command: cat /home/.homeassistant/HomeAutomation/cpu0temp.txt
      unit_of_measurement: "°C"
    
    - platform: command_line
      name: HD_1_Temperature
      command: cat /home/.homeassistant/HomeAutomation/HD1temp.txt
      unit_of_measurement: "°C"

    - platform: command_line
      name: HD_2_Temperature
      command: cat /home/.homeassistant/HomeAutomation/HD2temp.txt
      unit_of_measurement: "°C"

###################################################
#              Presence Detection                 #
###################################################

#Tracking through owntracks
owntracks:

  # If newly discovered devices are tracked by default (default: yes)
  track_new_devices: yes
  # Seconds between each scan for new devices
  interval_seconds: 12
  # Seconds to wait until marking someone as not home after not being seen
  # (default: 180)
  consider_home: 600 # is 10min

###################################################
#                  Notifications                  #
###################################################

notify:
    platform: pushbullet
    api_key: !secret pushbullet_key
    name: pushbullet

###################################################
#                      Servers                    #
###################################################

mqtt:
  broker: 192.168.1.5
  port: 1883
  client_id: home-assistant-1
  username: !secret mqtt_user
  password: !secret mqtt_pass
  
###################################################
#                  Transmission                   #
###################################################

transmission:
  host: 192.168.1.2
#  username: !secret transmission_user
#  password: !secret transmission_pass
  turtle_mode: true
  monitored_conditions:
    - 'current_status'
    - 'download_speed'
    - 'upload_speed'

    
###################################################
#                      Mining                     #
###################################################

sensor 6:
  - platform: coinmarketcap
    currency_id: 833
    
###################################################
#                    Groups                       #
###################################################

### Tabs

# Groups
group: 
    default_view: 
      view: yes
      entities: 
        - device_tracker.michael_pixel3
        - sensor.gridcoin
        - sensor.fedex
        - sensor.ups
        - group.Freenas
        - group.weather
        - group.cameras

    Control:
      view: yes
      entities:
        - sensor.living_room_thermostat_humidity
        - climate.living_room
        - group.HomeLights
#        - group.media_players
        - group.all_automations

### Details

    Freenas:
      name: Freenas
      entities: 
        - sensor.processor_use
        - sensor.cpu_0_temperature
        - sensor.memory_use_percent
        - sensor.memory_use
        - sensor.swap_use_percent
#        - sensor.swap_free
        - sensor.disk_free
#        - sensor.disk_use
        - sensor.hd_1_temperature
        - sensor.hd_2_temperature
        - sensor.last_boot
        - sensor.transmission_status
        - sensor.transmission_down_speed
        - sensor.transmission_up_speed
        - switch.transmission

    weather:
      name: Weather
      entities: 
        - sensor.dark_sky_summary
        - sensor.dark_sky_hourly_summary
        - sensor.dark_sky_temperature
        - sensor.dark_sky_precip
        - sensor.dark_sky_precip_intensity
        - sensor.dark_sky_precip_probability
        - sensor.dark_sky_pressure
        - sensor.dark_sky_wind_speed
        - sensor.dark_sky_humidity
        - sensor.dark_sky_dew_point
#        - sensor.dark_sky_visibility
        - sensor.dark_sky_uv_index
        - sensor.allergy_index_today_2
        - sensor.allergy_index_tomorrow_2
        - sensor.allergy_index_yesterday_2

    cameras:
      name: Watching
      entities:
        - camera.HomeWeatherRadar


    HomeLights:
      name: HomeLights
      entities:
        - switch.coach_lights_switch # Coach lights
        - switch.living_room_ligh_switch # Livingroom lights
        - switch.bedroom_lights_switch # Master bedroom lights
        - switch.entryway_light_switch # Entryway lights
        - switch.hall_light_switch # Hall light near bedroom
        - switch.tv_outlet_switch # Switch to turn TV on-off


###################################################
#                   Automation                    #
###################################################

# Automation
automation:
  - alias: 'Turn on Lights at Dusk'
    # Turns on Living room and outdoor lights when the sun goes down
    initial_state: 'on'
    trigger:
      platform: numeric_state
      entity_id: sun.sun
      value_template: '{{ state.attributes.elevation }}'
      below: 1.0
    action:
      - service: homeassistant.turn_on
        entity_id:
          - switch.coach_lights_switch # Coach lights
      - condition: state
        entity_id: switch.hall_light_switch
        state: 'off'
      - service: homeassistant.turn_on
        entity_id:
          - switch.living_room_ligh_switch # Livingroom lights

automation 2:
  - alias: 'Turn on lights in the morning after alarm'
    # Turns on master bedroom lights in the morning to help wake up
    # Relies on Sleep as Android (and tasker) for trigger and sun state for other lights
    initial_state: 'on'
    trigger:
      platform: webhook
      webhook_id: !secret morning_light_webhook
    action:
      - service: homeassistant.turn_on
        entity_id:
          - switch.bedroom_lights_switch # Master bedroom lights
          - switch.tv_outlet_switch
      - service: climate.set_operation_mode
        data:
          entity_id: climate.living_room
          operation_mode: 'auto'
      - condition: numeric_state
        entity_id: sun.sun
        value_template: '{{ state.attributes.elevation }}'
        below: 0.5
      - service: homeassistant.turn_on
        entity_id:
          - switch.living_room_ligh_switch # Livingroom lights
          
automation 3:
  - alias: 'Turn off Lights at Night'
    # Turn off Living room lights to force me to bed or if I have fallen asleep without starting sleep trackcing.
    # Also turns off outside lights as they don't need to stay on all night.  
    initial_state: 'on'
    trigger:
      platform: time
      at: '2:00:00'
    action:
      service: homeassistant.turn_off
      entity_id:
        - switch.coach_lights_switch # Coach lights
        - switch.living_room_ligh_switch # Livingroom lights
        - media_player.loki
        - switch.hall_light_switch
        - switch.entryway_light_switch
        - switch.tv_outlet_switch
        - switch.bedroom_lights_switch # Master bedroom lights

automation 4:
  - alias: 'Sleep time'
    # Turns off all inside lights after starting sleep.  Uses mqtt and tasker to send the message
    initial_state: 'on'
    trigger:
      platform: webhook
      webhook_id: !secret sleep_time_webhook
    action:
      - service: homeassistant.turn_off
        entity_id:
        - switch.living_room_ligh_switch # Livingroom lights
        - switch.bedroom_lights_switch # Master bedroom lights
        - media_player.loki
        - switch.hall_light_switch
        - switch.entryway_light_switch
        - switch.tv_outlet_switch
      - service: climate.set_operation_mode
        data:
          entity_id: climate.living_room
          operation_mode: 'eco'

automation 5:
  - alias: 'Turn off lights in the morning if needed'
    # Trns off lights in the morning if the sun rises after 6:30.  
    # This excludes the master bedroom as I may still need the lights on. 
    initial_state: 'on'
    trigger:
      platform: numeric_state
      entity_id: sun.sun
      value_template: '{{ state.attributes.elevation }}'
      above: 1.0
    condition:
      condition: time
      after: '06:00:00'
    action:
      service: homeassistant.turn_off
      entity_id:
        - switch.living_room_ligh_switch # Livingroom lights

automation 6:
  - alias: 'Bedtime'
    # Turns off main lights and TV when it is bedtime.  Uses mqtt and tasker to send the message
    initial_state: 'on'
    trigger:
      platform: webhook
      webhook_id: !secret bedtime_webhook
    condition:
      condition: state
      entity_id: switch.living_room_ligh_switch
      state: 'on'
    action:
      - service: homeassistant.turn_on
        entity_id:
        - switch.entryway_light_switch
        - switch.hall_light_switch
      - service: homeassistant.turn_off
        entity_id:
        - switch.living_room_ligh_switch # Livingroom lights
        - switch.tv_outlet_switch
        - media_player.loki


automation 7:
  - alias: 'Away Mode'
    # Sets house to away mode
    initial_state: 'on'
    trigger:
      platform: zone
      event: leave
      zone: zone.home
      entity_id: device_tracker.michael_pixel3
    action:
      - service: climate.set_operation_mode
        data:
          entity_id: climate.living_room
          operation_mode: 'eco'
      - service: homeassistant.turn_off
        entity_id:
        - switch.bedroom_lights_switch
        - switch.tv_outlet_switch

automation 8:
  - alias: 'Home'
    # Sets house to at home mode
    initial_state: 'on'
    trigger:
      platform: zone
      event: enter
      zone: zone.home
      entity_id: device_tracker.michael_pixel3
    action:
      - service: climate.set_operation_mode
        data:
          entity_id: climate.living_room
          operation_mode: 'auto'
      - service: homeassistant.turn_on
        entity_id:
        - switch.tv_outlet_switch

automation 9:
  - alias: 'Door Notification'
    # Sends notification when door opened if not home
    initial_state: 'on'
    trigger:
      platform: state
      entity_id: binary_sensor.ecolink_doorwindow_sensor_sensor
      from: 'off'
      to: 'on'
    condition:
      condition: state
      entity_id: device_tracker.michael_pixel3
      state: 'not_home'
    action:
      - service: notify.pushbullet
        data:
          message: "Garage door opened"
          title: "Door Opened"
