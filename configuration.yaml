homeassistant: # Name of the location where Home Assistant is running
  name: Home
  # Location required to calculate the time the sun rises and sets
  latitude: !secret home_lat
  longitude: !secret home_lon
  # Impacts weather/sunrise data (meters above sealevel)
  elevation: !secret home_elev
  # 'metric' for the metric system, 'imperial' for the imperial system
  unit_system: imperial
  # Pick yours from here: http://en.wikipedia.org/wiki/List_of_tz_database_time_zones
  time_zone: !secret time_zone
    
    
###################################################
#                 Customization                   #
###################################################

  customize: !include customize.yaml


###################################################
#                      Misc                       #
###################################################

# Configuration for the website
http:
    api_password: !secret api_pass_code
    base_url: !secret base_url
    
# Checks for available updates
updater:

# Enables support for tracking state changes over time.
history:

# Track the sun
sun:

# Discover some devices automatically
discovery:

# Allows you to issue voice commands from the frontend
conversation:

# View all events in a logbook
logbook:

# Enable config screen
config:

# Enables the frontend
frontend:
#  javascript_version: latest 

# Enable map screen
map:

# Show links to resources in log and frontend
#introduction:

###################################################
#                     Zones                       #
###################################################
zone:
  name: Work
  latitude: !secret work_lat
  longitude: !secret work_lon
  radius: 150
  icon: mdi:domain

zone 2:
  name: Honda R&D
  latitude: !secret guest_lat
  longitude: !secret guest_lon
  radius: 500
  icon: mdi:factory 

###################################################
#                      Hubs                       #
###################################################

zwave:
    usb_path: /dev/cuaU0
    polling_interval: 10000 # Polling speed in miliseconds
    # High polling number was needed to keep z-wave network stable and working
    
    new_entity_ids: true

###################################################
#                    Devices                      #
###################################################

media_player:
    platform: cast
    host: 192.168.1.120

media_player 2:
    platform: plex

#media_player 3:
#    platform: roku
#    host: 192.168.1.6


###################################################
#                      nest                       #
###################################################

nest: 
    client_id: !secret nest_client_id
    client_secret: !secret nest_client_secret

###################################################
#                    Weather                      #
###################################################

# Weather Prediction
sensor:
    platform: darksky
    api_key: !secret darksky_key
    monitored_conditions:
      - summary
      - temperature
      - precip_type
      - precip_intensity
      - precip_probability
      - wind_speed
      - wind_bearing
#      - cloud_cover
      - humidity
      - dew_point
      - pressure
      - visibility
#      - ozone
#      - minutely_summary
      - hourly_summary
#      - daily_summary

camera:
    platform: generic
    still_image_url: !secret radar_url
    name: HomeWeatherRadar

###################################################
#                  System info                    #
###################################################

# System resources
sensor 2: 
    - platform: systemmonitor
      resources: 
        - type: 'disk_use_percent'
          arg: '/'
        - type: 'disk_free'
          arg: '/'
        - type: 'memory_use_percent'
        - type: 'memory_use'
        - type: 'memory_free'
        - type: 'processor_use'
        - type: 'since_last_boot'
    
    - platform: command_line
      name: cpu_0_temperature
      command: cat /home/.homeassistant/HomeAutomation/cpu0temp.txt
      unit_of_measurement: "°C"
    
    - platform: command_line
      name: HD_1_Temperature
      command: cat /home/.homeassistant/HomeAutomation/HD1temp.txt
      unit_of_measurement: "°C"

    - platform: command_line
      name: HD_2_Temperature
      command: cat /home/.homeassistant/HomeAutomation/HD2temp.txt
      unit_of_measurement: "°C"

###################################################
#              Presence Detection                 #
###################################################

# Tracking through TP-Link Router 
# Stopped using after replacing with Owntracks.  Only 1 login is possible  
# at a time and Home Assistant locks the router from being accessed
#device_tracker:
#  platform: tplink
#  host: 192.168.1.1
#  username: !!secret tp_link_user
#  password: !secret tp_link_pass

# Tracking through nmap (higher cpu usage)
#device_tracker:
#    platform: nmap_tracker
#    hosts: 192.168.1.1/24
#    # Number of minutes nmap will not scan this 
#    # device, assuming it's home, in order to save
#    # battery life
#    home_interval: 5

#Tracking through owntracks
device_tracker:
  platform: owntracks

  # If newly discovered devices are tracked by default (default: yes)
  track_new_devices: yes
  # Seconds between each scan for new devices
  interval_seconds: 12
  # Seconds to wait until marking someone as not home after not being seen
  # (default: 180)
  consider_home: 600 # is 10min

###################################################
#                  Notifications                  #
###################################################

notify:
    platform: pushbullet
    api_key: !secret pushbullet_key
    name: pushbullet

###################################################
#                      Servers                    #
###################################################

mqtt:
  broker: 192.168.1.5
  port: 1883
  client_id: home-assistant-1
  username: !secret mqtt_user
  password: !secret mqtt_pass
  
###################################################
#                  Transmission                   #
###################################################

switch:
  platform: transmission
  host: 192.168.1.2
#  username: !secret transmission_user
#  password: !secret transmission_pass

sensor 3:
  - platform: transmission
    host: 192.168.1.2
#    username: !secret transmission_user
#    password: !secret transmission_pass
    monitored_variables:
      - 'current_status'
      - 'download_speed'
      - 'upload_speed'

###################################################
#                     Shipping                    #
###################################################

sensor 4:
  - platform: fedex
    username: !secret fedex_user
    password: !secret fedex_pass
    
sensor 5:
  - platform: ups
    username: !secret ups_user
    password: !secret ups_pass
    
usps:
    username: !secret usps_user
    password: !secret usps_pass

###################################################
#                    Groups                       #
###################################################

### Tabs

# Groups
group: 
    default_view: 
      view: yes
      entities: 
        - device_tracker.pi_shamu
        - group.Freenas
        - group.weather
        - group.HomeLights
        - group.HomeLightsTesting
        - group.all_switches
        - group.Shipping

    Control:
      view: yes
      entities:
        - climate.living_room
        - group.media_players
        - group.all_automations

### Details

    Freenas:
      name: Freenas
      entities: 
        - sensor.cpu_use
        - sensor.cpu_0_temperature
        - sensor.ram_use_2
        - sensor.ram_use
        - sensor.disk_free_
#        - sensor.disk_use_
        - sensor.hd_1_temperature
        - sensor.hd_2_temperature
        - sensor.since_last_boot
        - sensor.transmission_status
        - sensor.transmission_down_speed
        - sensor.transmission_up_speed
        - switch.transmission_turtle_mode

    weather:
      name: Weather
      entities: 
        - sensor.dark_sky_summary
        - sensor.dark_sky_hourly_summary
        - sensor.dark_sky_temperature
        - sensor.dark_sky_precip_type
        - sensor.dark_sky_precip_probability
        - sensor.dark_sky_wind_speed
        - sensor.dark_sky_humidity
        - sensor.dark_sky_dew_point
        - sensor.dark_sky_visibility
        - camera.HomeWeatherRadar

    media_players:
      name: Media_Players
      entities: 
        - media_player.loki
        - media_player.plex_web_chrome
        - media_player.roku_12c28s042036

    HomeLights:
      name: HomeLights
      entities:
        - switch.coach_lights_switch # Coach lights
        - switch.living_room_ligh_switch # Livingroom lights
        - switch.bedroom_lights_switch # Master bedroom lights
        - switch.entryway_light_switch # Entryway lights
        - switch.hall_light_switch # Hall light near bedroom
        - switch.tv_outlet_switch # Switch to turn TV on-off

    Shipping:
      name: Shipping
      entities:
        - sensor.fedex
        - sensor.ups
        - sensor.usps_packages
        - sensor.usps_mail
        - camera.usps_mail

###################################################
#                   Automation                    #
###################################################

# Automation
automation:
  - alias: 'Turn on Lights at Dusk'
    # Turns on Living room and outdoor lights when the sun goes down
    trigger:
      platform: numeric_state
      entity_id: sun.sun
      value_template: '{{ state.attributes.elevation }}'
      below: 1.0
    action:
      service: homeassistant.turn_on
      entity_id:
          - switch.coach_lights_switch # Coach lights
          - switch.living_room_ligh_switch # Livingroom lights

  - alias: 'Turn on lights in the morning after alarm'
    # Turns on master bedroom lights in the morning to help wake up
    # Relies on Sleep as Android (and tasker) for trigger and sun state for other lights
    trigger:
      platform: mqtt
      topic: wakeup
    action:
      - service: homeassistant.turn_on
        entity_id:
          - switch.bedroom_lights_switch # Master bedroom lights
      - service: climate.set_operation_mode
        data:
          entity_id: climate.living_room
          operation_mode: 'auto'
      - condition: numeric_state
        entity_id: sun.sun
        value_template: '{{ state.attributes.elevation }}'
        below: 0.5
      - service: homeassistant.turn_on
        entity_id:
          - switch.living_room_ligh_switch # Livingroom lights
          
  - alias: 'Turn off Lights at Night'
    # Turn off Living room lights to force me to bed or if I have fallen asleep without starting sleep trackcing.
    # Also turns off outside lights as they don't need to stay on all night.  
    trigger:
      platform: time
      hours: 2
      minutes: 0
      seconds: 0
    action:
      service: homeassistant.turn_off
      entity_id:
        - switch.coach_lights_switch # Coach lights
        - switch.living_room_ligh_switch # Livingroom lights
        - media_player.loki
        - switch.hall_light_switch
        - switch.entryway_light_switch
        - switch.tv_outlet_switch

  - alias: 'Sleep time'
    # Turns off all inside lights after starting sleep.  Uses mqtt and tasker to send the message
    trigger:
      platform: mqtt
      topic: sleep
    action:
      - service: homeassistant.turn_off
        entity_id:
        - switch.living_room_ligh_switch # Livingroom lights
        - switch.bedroom_lights_switch # Master bedroom lights
        - media_player.loki
        - switch.hall_light_switch
        - switch.entryway_light_switch
        - switch.tv_outlet_switch
      - service: climate.set_operation_mode
        data:
          entity_id: climate.living_room
          operation_mode: 'eco'

  - alias: 'Turn off lights in the morning if needed'
    # Trns off lights in the morning if the sun rises after 6:30.  
    # This excludes the master bedroom as I may still need the lights on. 
    trigger:
      platform: numeric_state
      entity_id: sun.sun
      value_template: '{{ state.attributes.elevation }}'
      above: 1.0
    condition:
      condition: time
      after: '06:00:00'

    action:
      service: homeassistant.turn_off
      entity_id:
        - switch.living_room_ligh_switch # Livingroom lights

  - alias: 'Update Available Notifications'
    trigger:
      platform: state
      entity_id: updater.updater
    action:
      service: notify.notify
      data:
        message: 'Update for Home Assistant is available.'
     
  - alias: 'Bedtime'
    # Turns off main lights and TV when it is bedtime.  Uses mqtt and tasker to send the message
    trigger:
      platform: mqtt
      topic: bedtime
    condition: state
      entity_id: switch.living_room_ligh_switch
      state: on
    action:
      - service: homeassistant.turn_off
        entity_id:
        - switch.living_room_ligh_switch # Livingroom lights
        - switch.tv_outlet_switch
        - media_player.loki
      - service: homeassistant.turn_on
        entity_id:
        - switch.entryway_light_switch
        - switch.hall_light_switch

  - alias: 'Away Mode'
    # Sets house to away mode
    trigger:
      platform: zone
      event: leave
      zone: zone.home
      entity_id: device_tracker.pi_shamu
    action:
      service: climate.set_operation_mode
      data:
        entity_id: climate.living_room
        operation_mode: 'eco'

  - alias: 'Home'
    # Sets house to at home mode
    trigger:
      platform: zone
      event: enter
      zone: zone.home
      entity_id: device_tracker.pi_shamu
    action:
      service: climate.set_operation_mode
      data:
        entity_id: climate.living_room
        operation_mode: 'auto'
          
# Scripts
script: 
